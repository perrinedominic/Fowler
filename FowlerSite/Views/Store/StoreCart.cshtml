@model IEnumerable<DataAccessLibrary.Models.CartItem>

@{
//ViewBag.Title = "StoreCart";
}


<!--
    Additional Classes:
        .nk-page-boxed
-->
<body>
    <!--
        START: Navbar Mobile

        Additional Classes:
            .nk-navbar-left-side
            .nk-navbar-right-side
            .nk-navbar-lg
            .nk-navbar-overlay-content
    -->
    <div id="nk-nav-mobile" class="nk-navbar nk-navbar-side nk-navbar-right-side nk-navbar-overlay-content d-lg-none">
        <div class="nano">
            <div class="nano-content">
                <a href="index.html" class="nk-nav-logo">
                    <img src="~/assets/images/logo.png" alt="" width="120">
                </a>
                <div class="nk-navbar-mobile-content">
                    <ul class="nk-nav">
                        <!-- Here will be inserted menu from [data-mobile-menu="#nk-nav-mobile"] -->
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!-- END: Navbar Mobile -->



    <div class="nk-main">

        <!-- START: Breadcrumbs -->
        <div class="nk-gap-1"></div>
        <div class="container">
            <ul class="nk-breadcrumbs">


                <li><a asp-action="Index">Home</a></li>


                <li><span class="fa fa-angle-right"></span></li>

                <li><a asp-action="Index">Store</a></li>


                <li><span class="fa fa-angle-right"></span></li>

                <li><span>Cart</span></li>

            </ul>
        </div>
        <div class="nk-gap-1"></div>
        <!-- END: Breadcrumbs -->


        <div class="container">
            <div class="nk-store nk-store-cart">

                    <!-- START: Products in Cart -->

                    @using(Html.BeginForm("Update", "Store", FormMethod.Post)) { 

                <div class="table-responsive">
                        <table class="table nk-store-cart-products">
                            <tbody>
                            @if (Model.Count() > 0)
                            {
                                <tr>
                                    <td class="font-weight-bold">
                                        Product:
                                    </td>
                                    <td class="font-weight-bold">
                                        Price:
                                    </td>
                                    <td class="font-weight-bold">
                                        Quantity:
                                    </td>
                                    <td class="font-weight-bold">
                                    </td>
                                </tr>

                                @foreach (var item in Model)
                                {
                            <tr>

                                @*<td class="d-lg-block">
            <img style="max-height:200px;" src="@Url.Content(item.Game.imagePath)" class="img-thumbnail" />
        </td>*@
                                <td>
                                    @Html.DisplayFor(modelItem => item.Game.Name)
                                </td>
                                <td id="itemPrice">
                                    $@Html.DisplayFor(modelItem => item.Game.Price)
                                </td>
                                <td id="itemQuantity">
                                    <input name="quantity" asp-data-id="@item.Quantity" type="number" value="@Html.DisplayFor(modelItem => item.Quantity)" class="form-control col-lg-3" min="1" max="10"  >
          </td>





          <td>

              <a asp-action="StoreCart" asp-route-id="-@item.ProductId" asp-controller="Store">Remove</a>

          </td>

      </tr>
                                }}
                            else
                            {
                                    <tr><td>Your cart is empty. <a asp-controller="Games" asp-action="Index">Click here</a> to find games.</td></tr>
                            }

                            </tbody>
                        </table>
                    
                    <!-- END: Products in Cart -->
                </div>
                <div class="nk-gap-1"></div>

                <input type="submit" class="nk-btn nk-btn-rounded nk-btn-color-white float-right" value="Update Cart" />
                }
                <div class="clearfix"></div>
                <div class="nk-gap-2"></div>
                <div class="row vertical-gap">
                    <div class="col-md-6">

                    </div>
                    <div class="col-md-6">
                        <!-- START: Cart Totals -->
                        <h3 class="nk-title h4">Cart Totals</h3>
                        <table class="nk-table nk-table-sm">
                            <tbody>
                                <tr class="nk-store-cart-totals-subtotal">
                                    <td>
                                        Subtotal
                                    </td>
                                    <td>
                                        @{decimal sum = 0;

                                            foreach (var x in Model)
                                            {

                                                sum += x.Quantity * x.Game.Price;

                                            }
                                            Output.WriteLine(sum);}
                                    </td>
                                </tr>
                                <tr class="nk-store-cart-totals-shipping">
                                    <td>
                                        Tax
                                    </td>
                                    <td>
                                        @{ decimal tax = .055m;
                                            decimal taxTotal = sum * tax;
                                            Output.WriteLine("$" + Math.Round(taxTotal, 2));
                                            }
                                    </td>
                                </tr>
                                <tr class="nk-store-cart-totals-total">
                                    <td>
                                        Total
                                    </td>
                                    <td>
                                        @{ 
                                            decimal total = sum + taxTotal;
                                            Output.WriteLine("$" + Math.Round(total, 2));
                                        }
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <!-- END: Cart Totals -->
                    </div>
                </div>

                <div class="nk-gap-2"></div>
                <a class="nk-btn nk-btn-rounded nk-btn-color-main-1 float-right" asp-action="StoreCheckout">Proceed to Checkout</a>
                <div class="clearfix"></div>
            </div>
        </div>

        <div class="nk-gap-2"></div>


    </div>




    <!-- START: Page Background -->

    <img class="nk-page-background-top" src="~/assets/images/bg-top-4.png" alt="">

    <!-- END: Page Background -->
    <!-- START: Search Modal -->
    <div class="nk-modal modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span class="ion-android-close"></span>
                    </button>

                    <h4 class="mb-0">Search</h4>

                    <div class="nk-gap-1"></div>
                    <form action="#" class="nk-form nk-form-style-1">
                        <input type="text" value="" name="search" class="form-control" placeholder="Type something and press Enter" autofocus>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- END: Search Modal -->
    <!-- START: Login Modal -->
    <div class="nk-modal modal fade" id="modalLogin" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span class="ion-android-close"></span>
                    </button>

                    <h4 class="mb-0"><span class="text-main-1">Sign</span> In</h4>

                    <div class="nk-gap-1"></div>
                    <form action="#" class="nk-form text-white">
                        <div class="row vertical-gap">
                            <div class="col-md-6">
                                Use email and password:

                                <div class="nk-gap"></div>
                                <input type="email" value="" name="email" class=" form-control" placeholder="Email">

                                <div class="nk-gap"></div>
                                <input type="password" value="" name="password" class="required form-control" placeholder="Password">
                            </div>
                            <div class="col-md-6">
                                Or social account:

                                <div class="nk-gap"></div>

                                <ul class="nk-social-links-2">
                                    <li><a class="nk-social-facebook" href="#"><span class="fab fa-facebook"></span></a></li>
                                    <li><a class="nk-social-google-plus" href="#"><span class="fab fa-google-plus"></span></a></li>
                                    <li><a class="nk-social-twitter" href="#"><span class="fab fa-twitter"></span></a></li>
                                </ul>
                            </div>
                        </div>

                        <div class="nk-gap-1"></div>
                        <div class="row vertical-gap">
                            <div class="col-md-6">
                                <a href="#" class="nk-btn nk-btn-rounded nk-btn-color-white nk-btn-block">Sign In</a>
                            </div>
                            <div class="col-md-6">
                                <div class="mnt-5">
                                    <small><a href="#">Forgot your password?</a></small>
                                </div>
                                <div class="mnt-5">
                                    <small><a href="#">Not a member? Sign up</a></small>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    </body>